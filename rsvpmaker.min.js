function showMessage(t){appslug=document.getElementById("appslug").value,console.log("appslug for message: "+appslug),document.getElementById("flexible-form-"+appslug).innerHTML="",document.getElementById("flexform-result-"+appslug).innerHTML=t.message}jQuery(document).ready(function(t){function e(n="",s=!0){t(".tz_converter").each(function(){var a=t(this).attr("id"),i=t(this).attr("time"),r=t(this).attr("end"),o=t(this).attr("format"),l=t(this).attr("post_id"),c=t(this).attr("server_timezone"),d=t(this).attr("timezone_abbrev"),p=t(this).attr("tz_url"),m=t(this).attr("nofluxbutton");console.log("post "+a+" noflux "+m),console.log(d);var h={},u={};if(s&&n==c){if(m)return;return t(this).css("display","inline-block"),u[a]=document.createElement("A"),u[a].innerHTML="Show in My Timezone",u[a].href=p,u[a].className="tzbutton",u[a].style.fontSize="small",document.getElementById(a).appendChild(u[a]),void u[a].addEventListener("click",t=>{t.preventDefault(),u[a].style.display="none";var n=jstz.determine(),s=n.name();e(s,!1)})}var v={time:i,end:r,tzstring:n,format:o,post_id:l,timezone_abbrev:d};console.log(v),jQuery.post(rsvpmaker_rest.rest_url+"rsvpmaker/v1/flux_capacitor",v,function(n){console.log(n),t("#"+a).html(n.content+" "),h[a]=document.createElement("SELECT"),h[a].innerHTML=n.tzoptions,h[a].className="tzselect",h[a].style.display="none",document.getElementById(a).appendChild(h[a]),h[a].addEventListener("change",t=>{var n=t.target.value;e(n,!1)}),u[a]=document.createElement("A"),u[a].innerHTML="Switch Timzeone?",u[a].className="tzswitch",u[a].style.fontSize="small",document.getElementById(a).appendChild(u[a]),u[a].addEventListener("click",t=>{h[a].style.display="block",u[a].style.display="none"})})})}function n(t){(t.first||t.last)&&(r=r.concat("<h3>"+t.first),t.last&&(r=r.concat(" "+t.last)),r=r.concat("</h3>\n"),t.note&&(r=r.concat("<p>"+t.note+"</p>")))}function s(e){var s=rsvpmaker_rest.rsvpmaker_json_url+"guestlist/"+e;fetch(s).then(t=>t.json()).then(s=>{Array.isArray(s)&&(s.forEach(n),""==r&&(r="<div>?</div>"),t("#attendees-"+e).html(r))}).catch(n=>{console.log(n),t("#attendees-"+e).html("Error fetching guestlist from "+s)})}t.ajaxSetup({headers:{"X-WP-Nonce":rsvpmaker_rest.nonce}}),t(".wp-block-rsvpmaker-formfield input").change(function(){let e=t(this).val(),n=e.includes("//");console.log(e+" "+n),n&&(e=e.replace(/[a-z]{0,8}:{0,1}\/\//,""),console.log("strip prefix"),t(this).val(e))}),t(".rsvpmaker-schedule-detail").hide(),t(".rsvpmaker-schedule-button").click(function(e){var n=t(this).attr("id"),s=n.replace("button","detail");t("#"+n).hide(),t("#"+s).show()}),t(".wp-block-rsvpmaker-countdown").each(function(){var e=t(this).attr("event_id"),n=t(this).attr("id");if(""==e){var s=n.split("-");s[1]&&(e=s[1])}if(""==e)return;let a=rsvpmaker_rest.rest_url+"rsvpmaker/v1/time_and_zone/"+e;jQuery.get(a,null,function(e){let s=parseInt(e);if(Number.isNaN(s))return void t("#"+n).html("Event not found");let a=setInterval(function(){var e=(new Date).getTime(),i=s-e,r=Math.floor(i/864e5),o=Math.floor(i%864e5/36e5),l=o<10?"0":"",c=Math.floor(i%36e5/6e4),d=c<10?"0":"",p=Math.floor(i%6e4/1e3),m=p<10?"0":"";if(i<0){clearInterval(a),r=o=c=p="00";let e=t("#"+n).attr("expiration_display"),s=t("#"+n).attr("expiration_message"),i="";"stoppedclock"!=e&&"clockmessage"!=e||(i='<div class="countdowndigits-line"><div class="countdowndigits countdowndays">'+r+'</div> <span class="countdowndayslabel">days</span> <div class="countdowndigits countdownhours">'+o+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownminutes">'+c+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownseconds">'+p+"</div></div>"),"message"!=e&&"clockmessage"!=e||(i=i+'<p class="countdown_expiration_message">'+s+"</p>"),t("#"+n).html(i)}else t("#"+n).html('<div class="countdowndigits-line"><div class="countdowndigits countdowndays">'+r+'</div> <span class="countdowndayslabel">days</span> <div class="countdowndigits countdownhours">'+l+o+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownminutes">'+d+c+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownseconds">'+m+p+"</div></div>")},1e3)})}),t(".timezone_on").click(function(){var e=t(this).attr("utc"),n=t(this).attr("target"),s=n.replace("timezone_converted","tz_convert_to"),a=t(this).attr("event_tz");if(""!=a){var i=new Date(e);localstring=i.toString(),t("#"+n).html(localstring);var r=localstring.match(/\(([^)]+)/);t(this).attr("event_tz",""),t("#"+s).html("Converting to "+r[1]);var o,l=e.split(/T/);t(".tz-convert, .tz-convert table tr td, .tz-table1 table tr td:first-child, .tz-table2 table tr td:nth-child(2), .tz-table3 table tr td:nth-child(3)").each(function(){celltime=this.innerHTML.replace("&nbsp;"," "),celltime.search(/\d:\d\d/)>=0&&celltime.search("<")<0&&(0,o=l[0]+" "+celltime+" "+a,ts=Date.parse(o),Number.isNaN(ts)||(i.setTime(ts),o=i.toLocaleTimeString().replace(":00 "," "),this.innerHTML=o,t(this).css("font-weight","bold")))});var c=!0;t(".tz-table1 table tr td:first-child, .tz-table2 table tr td:nth-child(2), .tz-table3 table tr td:nth-child(3)").each(function(){c&&""!=this.innerHTML&&this.innerHTML.search(":")<0&&(this.innerHTML="<strong>Your TZ</strong>"),c=!1});var d={action:"rsvpmaker_localstring",localstring:localstring,timelord:rsvpmaker_rest.timelord};jQuery.post(rsvpmaker_rest.ajaxurl,d,function(e){t("#"+n).html(e)})}}),t(".signed_up_ajax").each(function(){var e=t(this).attr("post"),n={event:e,timelord:rsvpmaker_rest.timelord};jQuery.get(rsvpmaker_rest.rest_url+"rsvpmaker/v1/signed_up",n,function(n){t("#signed_up_"+e).html(n)})});var a=jstz.determine(),i=a.name();e(i);var r="";t(".rsvpmaker_show_attendees").click(function(e){var n=t(this).attr("post_id");r="",s(n)});const o=document.getElementsByClassName("rsvpmaker_menu_dropdown");if(o&&o.length){const t=[];let e=0;Array.prototype.filter.call(o,(n,s)=>{if(n.className.includes("rsvpmaker_menu_dropdown"))if(e++,console.log("dropdown",n),console.log("dropdown children",n.children),n.className.includes("rsvpmaker_menu_type")){const e=n.className.match(/rsvpmaker_menu_type_([^\s]+)/);e&&e[1]&&fetch("/wp-json/rsvpmaker/v1/type/"+e[1]).then(t=>t.json()).then(e=>{t.push(""),Array.isArray(e)&&e.forEach(e=>{t[t.length-1]+='<li class=" wp-block-navigation-item wp-block-navigation-link"><a class="wp-block-navigation-item__content" href="'+e.permalink+'"><span class="wp-block-navigation-item__label">'+e.post_title+" - "+e.date+"</span></a></li>"}),t[t.length-1]&&Array.prototype.filter.call(n.children,e=>{"UL"==e.nodeName&&(e.innerHTML=e.innerHTML+t[t.length-1])})})}else fetch("/wp-json/rsvpmaker/v1/future").then(t=>t.json()).then(e=>{t.push(""),console.log(e);let s=!1;Array.isArray(e)&&e.forEach((e,n)=>{n<12?t[t.length-1]+='<li class=" wp-block-navigation-item wp-block-navigation-link"><a class="wp-block-navigation-item__content" href="'+e.permalink+'"><span class="wp-block-navigation-item__label">'+e.post_title+" - "+e.date+"</span></a></li>":s=!0}),s&&(t[t.length-1]+='<li class=" wp-block-navigation-item wp-block-navigation-link"><a class="wp-block-navigation-item__content" href="/rsvpmaker/page/2/"><span class="wp-block-navigation-item__label">More Events</span></a></li>'),t[t.length-1]&&Array.prototype.filter.call(n.children,e=>{"UL"==e.nodeName&&(e.innerHTML=e.innerHTML+t[t.length-1])})})})}});class RSVPJsonWidget{constructor(t,e,n,s=""){this.el=document.getElementById(t),this.url=e,this.limit=n,this.morelink=s;let a="";fetch(e).then(t=>t.json()).then(t=>{var e=!1;Array.isArray(t)?(n&&t.length>=n&&(t=t.slice(0,n),e=!0),t.forEach(function(t,e,n){if(!t.datetime)return"";new Date(t.datetime);a=a.concat('<li class="rsvpmaker-widget-li"><span class="rsvpmaker-widget-title"><a href="'+t.guid+'">'+t.post_title+'</a></span> - <span class="rsvpmaker-widget-date">'+t.date+"</span></li>")})):this.el.innerHTML="None found: "+t.code,""==a?this.el.innerHTML="No event listings found":(e&&""!=s&&(a=a.concat('<li><a href="'+s+'">More events</a></li>')),this.el.innerHTML='<ul class="eventslist rsvpmakerjson">'+a+"</ul>")}).catch(t=>{this.el.innerHTML="Error fetching events from "+this.url,console.log(t)})}}const flexforms=document.querySelectorAll(".rsvpmaker-flexible-form");flexforms.forEach(t=>{t.addEventListener("submit",function(t){t.preventDefault();const e=new FormData(this);console.log(e),fetch(rsvpmaker_rest.rest_url+"rsvpmaker/v1/flexform",{method:"POST",body:e}).then(t=>t.json()).then(t=>showMessage(t))})});