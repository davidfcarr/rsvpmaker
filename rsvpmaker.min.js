function showMessage(e){appslug=document.getElementById("appslug").value,console.log("appslug for message: "+appslug),document.getElementById("flexible-form-"+appslug).innerHTML="",document.getElementById("flexform-result-"+appslug).innerHTML=e.message}jQuery(document).ready(function(e){function t(n="",s=!0){e(".tz_converter").each(function(){var a=e(this).attr("id"),l=e(this).attr("time"),r=e(this).attr("end"),o=e(this).attr("format"),i=e(this).attr("post_id"),c=e(this).attr("server_timezone"),d=e(this).attr("timezone_abbrev"),p=e(this).attr("tz_url"),u=e(this).attr("nofluxbutton");console.log("post "+a+" noflux "+u),console.log(d);var v={},m={};if(s&&n==c){if(u)return;return e(this).css("display","inline-block"),m[a]=document.createElement("A"),m[a].innerHTML="Show in My Timezone",m[a].href=p,m[a].className="tzbutton",m[a].style.fontSize="small",document.getElementById(a).appendChild(m[a]),void m[a].addEventListener("click",e=>{e.preventDefault(),m[a].style.display="none";var n=jstz.determine(),s=n.name();t(s,!1)})}var h={time:l,end:r,tzstring:n,format:o,post_id:i,timezone_abbrev:d};console.log(h),jQuery.post(rsvpmaker_rest.rest_url+"rsvpmaker/v1/flux_capacitor",h,function(n){console.log(n),e("#"+a).html(n.content+" "),v[a]=document.createElement("SELECT"),v[a].innerHTML=n.tzoptions,v[a].className="tzselect",v[a].style.display="none",document.getElementById(a).appendChild(v[a]),v[a].addEventListener("change",e=>{var n=e.target.value;t(n,!1)}),m[a]=document.createElement("A"),m[a].innerHTML="Switch Timzeone?",m[a].className="tzswitch",m[a].style.fontSize="small",document.getElementById(a).appendChild(m[a]),m[a].addEventListener("click",e=>{v[a].style.display="block",m[a].style.display="none"})})})}function n(e){(e.first||e.last)&&(p=p.concat("<h3>"+e.first),e.last&&(p=p.concat(" "+e.last)),p=p.concat("</h3>\n"),e.note&&(p=p.concat("<p>"+e.note+"</p>")))}function s(t){var s=rsvpmaker_rest.rsvpmaker_json_url+"guestlist/"+t;fetch(s).then(e=>e.json()).then(s=>{Array.isArray(s)&&(s.forEach(n),""==p&&(p="<div>?</div>"),e("#attendees-"+t).html(p))}).catch(n=>{console.log(n),e("#attendees-"+t).html("Error fetching guestlist from "+s)})}if(e.ajaxSetup({headers:{"X-WP-Nonce":rsvpmaker_rest.nonce}}),e("#formvars")){const t=e("#formvars").attr("hide"),n=e("#formvars").attr("events_to_add"),s=e("#formvars").attr("options"),c=e("#formvars").attr("is_admin"),d=e("#formvars").attr("email_lookup");let p=parseInt(e("#guestcount").val());e("#rsvp_more_events_click").click(()=>{n>0?e("#more_rsvp_events").append('<p><select name="rsvpmultievent[]">'+s+"</select></p>"):0==n&&e("#more_rsvp_events").append("<p>Reached limit</p>"),n--}),e("#coupon_field").hide(),e("#coupon_field_add").click(()=>{e("#coupon_field").show(),e("#coupon_field_prompt").hide()}),e("#guest_count_pricing select").change(function(){e("#rsvpform input").prop("disabled",!1),e("#rsvpform select").prop("disabled",!1),e("#rsvpform div").show(),e("#rsvpform p").show();var n=e(this).val(),s=t[n];e.each(s,function(t,n){e("div."+n).hide(),e("p."+n).hide(),e("."+n).prop("disabled",!0)})});var a,l=e("#max_guests").val();console.log("max guests ",l);var r=e("#first_blank").html();console.log("initial blank",r);var o=!0;let u=0,v="";e("#add_guests").click(function(n){if(n.preventDefault(),u=parseInt(e("#number_to_add").val()),console.log("number_to_add",u),a=e("#last").val(),console.log("number to add",u),console.log("guestcount",p),o){o=!1;let t=r.replace(/\[\]/g,"["+p+"]").replace("###",p),n=""!=a?a:"TBD";if(t=t.replace(/\[first\][^\>]+value="/,"$&Guest "+p).replace(/\[last\][^\>]+value="/,"$&"+n),e("#first_blank").html(t),e("#first_blank").show(),p++,e("#totalparty").html(p),u--,!u)return}for(let t=0;t<u;t++){if(!c&&p>l)return console.log("guest limit reached"),console.log("guest count",p),console.log("max_guests",l),void e("#first_blank").append("<p><em>Guest limit reached</em></p>");console.log("guestline loop",t),console.log("guestline number to add",u),console.log("guestline guestcount",p),v='<div class="guest_blank">'+r.replace(/\[\]/g,"["+p+"]").replace("###",p).replace(/\[first\][^\>]+value="/,"$&Guest "+p).replace(/\[last\][^\>]+value="/,"$&"+a)+"</div>",p++,e("#first_blank").append(v)}if(t){var s=e("#guest_count_pricing select").val(),i=t[s];e.each(i,function(t,n){e("div."+n).hide(),e("p."+n).hide(),e("."+n).prop("disabled",!0)})}}),jQuery("#rsvpform").submit(function(){var t="",n=jQuery("#required").val(),s=n.split(",");return e.each(s,function(e,n){"privacy_consent"==n?jQuery("#privacy_consent:checked").val()||(t+='<div class="rsvp_missing">privacy policy consent checkbox</div>'):""===jQuery("#"+n).val()&&(t=t+'<div class="rsvp_missing">'+n+"</div>")}),""==t||(jQuery("#jqerror").html('<div class="rsvp_validation_error">Required fields left blank:\n'+t+"</div>"),!1)});var i=null;e(function(){var t=3;e("#email").keyup(function(){value=e(this).val();var n=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;e("#event").val();if(value.length>=t&&value.match(n)){null!=i&&i.abort();var s={email_search:value};jQuery.get(d,s,function(t){e("#rsvp_email_lookup").html('<div style="border: medium solid red; padding: 5px; background-color:#fff; color: red;">'+t+"</div>")})}})})}e(".wp-block-rsvpmaker-formfield input").change(function(){let t=e(this).val(),n=t.includes("//");console.log(t+" "+n),n&&(t=t.replace(/[a-z]{0,8}:{0,1}\/\//,""),console.log("strip prefix"),e(this).val(t))}),e(".rsvpmaker-schedule-detail").hide(),e(".rsvpmaker-schedule-button").click(function(t){var n=e(this).attr("id"),s=n.replace("button","detail");e("#"+n).hide(),e("#"+s).show()}),e(".wp-block-rsvpmaker-countdown").each(function(){var t=e(this).attr("event_id"),n=e(this).attr("id");if(""==t){var s=n.split("-");s[1]&&(t=s[1])}if(""==t)return;let a=rsvpmaker_rest.rest_url+"rsvpmaker/v1/time_and_zone/"+t;jQuery.get(a,null,function(t){let s=parseInt(t);if(Number.isNaN(s))return void e("#"+n).html("Event not found");let a=setInterval(function(){var t=(new Date).getTime(),l=s-t,r=Math.floor(l/864e5),o=Math.floor(l%864e5/36e5),i=o<10?"0":"",c=Math.floor(l%36e5/6e4),d=c<10?"0":"",p=Math.floor(l%6e4/1e3),u=p<10?"0":"";if(l<0){clearInterval(a),r=o=c=p="00";let t=e("#"+n).attr("expiration_display"),s=e("#"+n).attr("expiration_message"),l="";"stoppedclock"!=t&&"clockmessage"!=t||(l='<div class="countdowndigits-line"><div class="countdowndigits countdowndays">'+r+'</div> <span class="countdowndayslabel">days</span> <div class="countdowndigits countdownhours">'+o+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownminutes">'+c+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownseconds">'+p+"</div></div>"),"message"!=t&&"clockmessage"!=t||(l=l+'<p class="countdown_expiration_message">'+s+"</p>"),e("#"+n).html(l)}else e("#"+n).html('<div class="countdowndigits-line"><div class="countdowndigits countdowndays">'+r+'</div> <span class="countdowndayslabel">days</span> <div class="countdowndigits countdownhours">'+i+o+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownminutes">'+d+c+'</div><span class="countdownspacer">:</span><div class="countdowndigits countdownseconds">'+u+p+"</div></div>")},1e3)})}),e(".timezone_on").click(function(){var t=e(this).attr("utc"),n=e(this).attr("target"),s=n.replace("timezone_converted","tz_convert_to"),a=e(this).attr("event_tz");if(""!=a){var l=new Date(t);localstring=l.toString(),e("#"+n).html(localstring);var r=localstring.match(/\(([^)]+)/);e(this).attr("event_tz",""),e("#"+s).html("Converting to "+r[1]);var o,i=t.split(/T/);e(".tz-convert, .tz-convert table tr td, .tz-table1 table tr td:first-child, .tz-table2 table tr td:nth-child(2), .tz-table3 table tr td:nth-child(3)").each(function(){celltime=this.innerHTML.replace("&nbsp;"," "),celltime.search(/\d:\d\d/)>=0&&celltime.search("<")<0&&(0,o=i[0]+" "+celltime+" "+a,ts=Date.parse(o),Number.isNaN(ts)||(l.setTime(ts),o=l.toLocaleTimeString().replace(":00 "," "),this.innerHTML=o,e(this).css("font-weight","bold")))});var c=!0;e(".tz-table1 table tr td:first-child, .tz-table2 table tr td:nth-child(2), .tz-table3 table tr td:nth-child(3)").each(function(){c&&""!=this.innerHTML&&this.innerHTML.search(":")<0&&(this.innerHTML="<strong>Your TZ</strong>"),c=!1});var d={action:"rsvpmaker_localstring",localstring:localstring,timelord:rsvpmaker_rest.timelord};jQuery.post(rsvpmaker_rest.ajaxurl,d,function(t){e("#"+n).html(t)})}}),e(".signed_up_ajax").each(function(){var t=e(this).attr("post"),n={event:t,timelord:rsvpmaker_rest.timelord};jQuery.get(rsvpmaker_rest.rest_url+"rsvpmaker/v1/signed_up",n,function(n){e("#signed_up_"+t).html(n)})});var c=jstz.determine(),d=c.name();t(d);var p="";e(".rsvpmaker_show_attendees").click(function(t){var n=e(this).attr("post_id");p="",s(n)});const u=document.getElementsByClassName("rsvpmaker_menu_dropdown");if(u&&u.length){const e=[];let t=0;Array.prototype.filter.call(u,(n,s)=>{if(n.className.includes("rsvpmaker_menu_dropdown"))if(t++,console.log("dropdown",n),console.log("dropdown children",n.children),n.className.includes("rsvpmaker_menu_type")){const t=n.className.match(/rsvpmaker_menu_type_([^\s]+)/);t&&t[1]&&fetch("/wp-json/rsvpmaker/v1/type/"+t[1]).then(e=>e.json()).then(t=>{e.push(""),Array.isArray(t)&&t.forEach(t=>{e[e.length-1]+='<li class=" wp-block-navigation-item wp-block-navigation-link"><a class="wp-block-navigation-item__content" href="'+t.permalink+'"><span class="wp-block-navigation-item__label">'+t.post_title+" - "+t.neatdate+"</span></a></li>"}),e[e.length-1]&&Array.prototype.filter.call(n.children,t=>{"UL"==t.nodeName&&(t.innerHTML=t.innerHTML+e[e.length-1])})})}else fetch("/wp-json/rsvpmaker/v1/future").then(e=>e.json()).then(t=>{e.push(""),console.log(t);let s=!1;Array.isArray(t)&&t.forEach((t,n)=>{n<12?e[e.length-1]+='<li class=" wp-block-navigation-item wp-block-navigation-link"><a class="wp-block-navigation-item__content" href="'+t.permalink+'"><span class="wp-block-navigation-item__label">'+t.post_title+" - "+t.neatdate+"</span></a></li>":s=!0}),s&&(e[e.length-1]+='<li class=" wp-block-navigation-item wp-block-navigation-link"><a class="wp-block-navigation-item__content" href="/rsvpmaker/page/2/"><span class="wp-block-navigation-item__label">More Events</span></a></li>'),e[e.length-1]&&Array.prototype.filter.call(n.children,t=>{"UL"==t.nodeName&&(t.innerHTML=t.innerHTML+e[e.length-1])})})})}});class RSVPJsonWidget{constructor(e,t,n,s=""){this.el=document.getElementById(e),this.url=t,this.limit=n,this.morelink=s;let a="";fetch(t).then(e=>e.json()).then(e=>{var t=!1;Array.isArray(e)?(n&&e.length>=n&&(e=e.slice(0,n),t=!0),e.forEach(function(e,t,n){if(!e.datetime)return"";new Date(e.datetime);a=a.concat('<li class="rsvpmaker-widget-li"><span class="rsvpmaker-widget-title"><a href="'+e.guid+'">'+e.post_title+'</a></span> - <span class="rsvpmaker-widget-date">'+e.date+"</span></li>")})):this.el.innerHTML="None found: "+e.code,""==a?this.el.innerHTML="No event listings found":(t&&""!=s&&(a=a.concat('<li><a href="'+s+'">More events</a></li>')),this.el.innerHTML='<ul class="eventslist rsvpmakerjson">'+a+"</ul>")}).catch(e=>{this.el.innerHTML="Error fetching events from "+this.url,console.log(e)})}}const flexforms=document.querySelectorAll(".rsvpmaker-flexible-form");flexforms.forEach(e=>{e.addEventListener("submit",function(e){e.preventDefault();const t=new FormData(this);console.log(t),fetch(rsvpmaker_rest.rest_url+"rsvpmaker/v1/flexform",{method:"POST",body:t}).then(e=>e.json()).then(e=>showMessage(e))})});